services:
###############################################################################
# 1 â–¸ Redis  (internal, free plan, no auth)
###############################################################################
- type: redis
  name: pdf-redis
  plan: free
  maxmemoryPolicy: allkeys-lru        # reasonable default
  enableInternalAuth: false           # ðŸ”‘ TURN OFF password
  ipAllowList: []                     # empty â†’ only Render services (same account/region)

###############################################################################
# 2 â–¸ Spring-Boot back-end (API)
###############################################################################
- type: web
  name: pdf-chatbot-api
  runtime: docker
  autoDeploy: true

  envVars:
    # â”€â”€ OpenAI secret â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - key: OPENAI_API_KEY
      sync: false                      # add the value in the dashboard

    # â”€â”€ Redis (internal host & port, no password) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - key: REDIS_HOST
      fromService:
        type: redis
        name: pdf-redis
        property: host                # â‡’ "pdf-redis"
    - key: REDIS_PORT
      fromService:
        type: redis
        name: pdf-redis
        property: port                # â‡’ "6379"

###############################################################################
# 3 â–¸ React front-end (static site)  â”€â”€ OPTIONAL
###############################################################################
- type: web
  name: pdf-chat-ui
  runtime: static
  buildCommand: cd pdf-chat-ui && npm ci && npm run build
  staticPublishPath: pdf-chat-ui/build
  pullRequestPreviewsEnabled: false

  # Expose the API host:port to React if needed
  envVars:
    - key: REACT_APP_API_HOSTPORT
      fromService:
        type: web
        name: pdf-chatbot-api
        property: hostport            # e.g. "pdf-chatbot-api:8080"
